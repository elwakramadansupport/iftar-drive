<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ramadan Iftar Drive | Elwak</title>

  <style>
    :root{
      --bg1:#0f4c75; --bg2:#0b3c5d; --bg3:#06283d;
      --gold:#ffd700; --green:#1eb53a; --stroke:rgba(255,255,255,.16);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:#fff;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:
        radial-gradient(900px 420px at 18% 10%, rgba(255,215,0,.18), transparent 60%),
        radial-gradient(900px 420px at 82% 22%, rgba(30,181,58,.16), transparent 55%),
        radial-gradient(circle at top, var(--bg1), var(--bg2), var(--bg3));
    }
    .wrap{
      width:min(940px,100%);
      background: linear-gradient(to bottom right, rgba(255,255,255,0.14), rgba(255,255,255,0.06));
      border:1px solid var(--stroke);
      border-radius:24px;
      box-shadow: 0 26px 60px rgba(0,0,0,.38);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }
    .hero{padding:20px 18px 14px;text-align:center}
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 14px;border-radius:999px;
      background:rgba(255,215,0,.14);
      border:1px solid rgba(255,215,0,.35);
      color:var(--gold);font-weight:900;
      letter-spacing:1.2px;text-transform:uppercase;font-size:.78rem
    }
    h1{margin:14px 0 6px;font-size:clamp(1.55rem,3.3vw,2.6rem);font-weight:900;line-height:1.1}
    .sub{margin:0 auto;max-width:56rem;opacity:.94;line-height:1.55;font-size:1.02rem}

    .content{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
      padding: 0 18px 18px;
    }
    .card{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      padding:16px;
    }
    .small{font-size:.95rem;opacity:.94;line-height:1.5;margin:0}

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    .stat{
      padding:12px;
      border-radius:16px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      text-align:center;
    }
    .stat b{display:block;font-size:.85rem;opacity:.9;margin-bottom:4px}
    .stat span{font-size:1.15rem;font-weight:900}

    .barWrap{
      margin-top:10px;
      padding:10px;
      border-radius:16px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
    }
    .bar{
      height:12px;border-radius:999px;
      background: rgba(255,255,255,.12);
      overflow:hidden;
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(30,181,58,1), rgba(255,215,0,.95));
      border-radius:999px;
      transition: width .35s ease;
    }
    .barNote{margin-top:8px;font-size:.9rem;opacity:.92;text-align:center}

    .grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap:10px;
      margin-top:12px;
    }
    .amt{
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      padding:12px 10px;
      cursor:pointer;
      color:#fff;
      font-weight:900;
      background: rgba(255,255,255,.12);
      transition: transform .06s ease, background .18s ease, border-color .18s ease;
    }
    .amt:hover{background: rgba(255,255,255,.18);border-color: rgba(255,255,255,.20)}
    .amt:active{transform: scale(.98)}
    .amt.sel{
      background: linear-gradient(135deg, rgba(30,181,58,.95), rgba(30,181,58,.78));
      border-color: rgba(30,181,58,.55);
      box-shadow: 0 14px 26px rgba(30,181,58,.22);
    }

    .row{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap;margin-top:12px}
    input{
      width: 260px; max-width:100%;
      padding:12px 14px;border-radius:16px;
      border:1px solid rgba(255,255,255,.20);
      background: rgba(255,255,255,.08);
      color:#fff;outline:none;font-size:1rem;
    }
    input::placeholder{color:rgba(255,255,255,.72)}

    .tillBox{
      margin-top:10px;
      border-radius:18px;
      padding:16px;
      background: linear-gradient(135deg, rgba(30,181,58,1), rgba(30,181,58,.82));
      border:1px solid rgba(255,255,255,.20);
      box-shadow: 0 18px 34px rgba(30,181,58,.20);
      text-align:center;
    }
    .tillLabel{font-weight:900;letter-spacing:1.6px;text-transform:uppercase;font-size:.85rem;opacity:.95}
    .tillNum{margin-top:8px;font-size:2.2rem;font-weight:900;letter-spacing:3px}

    .kpi{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .kpi > div{
      padding:12px;border-radius:16px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      text-align:center;
    }
    .kpi b{display:block;font-size:.85rem;opacity:.9;margin-bottom:4px}
    .kpi span{font-size:1.05rem;font-weight:900}

    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;justify-content:center}
    .btn{border:0;border-radius:16px;padding:12px 14px;font-weight:900;cursor:pointer}
    .primary{background: var(--gold); color:#0b3c5d;}
    .ghost{background: rgba(255,255,255,.10); color:#fff; border:1px solid rgba(255,255,255,.14);}
    .danger{background: rgba(255,255,255,.06); color:#fff; border:1px solid rgba(255,255,255,.12);}

    .toast{
      margin-top:10px;
      font-size:.95rem;
      text-align:center;
      opacity:.95;
      display:none;
      padding:10px 12px;
      border-radius:14px;
      background: rgba(255,215,0,.12);
      border:1px solid rgba(255,215,0,.28);
    }

    .footer{text-align:center;padding:12px 14px 16px;opacity:.86;font-size:.9rem;border-top:1px solid rgba(255,255,255,.10)}

    /* Thanks modal */
    .modalOverlay{
      display:none;
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      padding:18px;
      z-index:9999;
    }
    .modal{
      max-width:520px;
      margin:10vh auto;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      border-radius:18px;
      padding:18px;
      backdrop-filter: blur(14px);
      box-shadow: 0 24px 55px rgba(0,0,0,.35);
    }
    .modalTitle{
      font-weight:900;
      font-size:1.15rem;
      color: var(--gold);
      margin-bottom:8px;
    }
    .modalText{
      line-height:1.55;
      opacity:.95;
      margin-bottom:14px;
      font-size:.98rem;
    }
    .modalActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    @media (max-width: 860px){
      .content{grid-template-columns:1fr}
      .grid{grid-template-columns: repeat(2, minmax(0,1fr))}
      .stats{grid-template-columns:1fr}
      .tillNum{font-size:2.0rem}
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="hero">
      <div class="badge">RAMADAN IFTAR DRIVE • ELWAK</div>
      <h1>Feed a fasting family for the sake of Allah</h1>
      <p class="sub">
        Select an amount, pay to the Till number, then tap <b>✅ I’ve Participated</b> to update our live total and participant count.
      </p>

      <div class="stats">
        <div class="stat"><b>Total Raised</b><span id="totalRaised">KSh 0</span></div>
        <div class="stat"><b>Participants</b><span id="participants">0</span></div>
        <div class="stat"><b>Remaining</b><span id="remaining">KSh 500,000</span></div>
      </div>

      <div class="barWrap">
        <div class="bar"><div class="fill" id="fill"></div></div>
        <div class="barNote" id="barNote">0% of target reached</div>
      </div>
    </div>

    <div class="content">

      <!-- LEFT -->
      <div class="card">
        <p class="small">
          <b style="color:var(--gold);">Reward reminder:</b>
          “Whoever feeds a fasting person will have a reward equal to theirs, without reducing their reward in any way.”
        </p>

        <div class="grid" id="amtGrid">
          <button class="amt" data-amt="100">KSh 100</button>
          <button class="amt" data-amt="200">KSh 200</button>
          <button class="amt" data-amt="300">KSh 300</button>
          <button class="amt" data-amt="500">KSh 500</button>
          <button class="amt" data-amt="1000">KSh 1,000</button>
          <button class="amt" data-amt="1500">KSh 1,500</button>
          <button class="amt" data-amt="2000">KSh 2,000</button>
          <button class="amt" data-amt="custom">Any Amount</button>
        </div>

        <div class="row">
          <input id="customAmt" type="number" min="1" inputmode="numeric" placeholder="Type any amount (e.g., 750)" />
        </div>

        <div class="toast" id="toast"></div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="kpi">
          <div><b>Selected Amount</b><span id="selAmt">None</span></div>
          <div><b>Reference</b><span id="ref">—</span></div>
        </div>

        <div class="tillBox">
          <div class="tillLabel">Buy Goods Till</div>
          <div class="tillNum">4341738</div>
        </div>

        <p class="small" style="margin-top:10px;">
          <b>Pay normally:</b> M-Pesa → Lipa na M-Pesa → Buy Goods → Till <b>4341738</b> → Amount → Pay.
          Then tap <b>✅ I’ve Participated</b>.
        </p>

        <div class="actions">
          <button class="btn primary" onclick="openMpesa()">Pay with M-Pesa</button>
          <button class="btn ghost" onclick="copyTill()">Copy Till</button>
          <button class="btn ghost" onclick="shareWhatsApp()">Share on WhatsApp</button>
          <button class="btn ghost" onclick="copyAmount()">Copy Amount</button>
          <button class="btn primary" onclick="iParticipated()">✅ I’ve Participated</button>
          <button class="btn danger" onclick="resetAll()">Reset</button>
        </div>
      </div>

    </div>

    <div class="footer">Ramadan • Mercy • Shared Responsibility</div>
  </div>

  <!-- THANK YOU MODAL -->
  <div id="thanksModal" class="modalOverlay">
    <div class="modal">
      <div class="modalTitle">جزاك الله خيرًا — Thank you!</div>
      <div id="thanksText" class="modalText">Your participation has been recorded.</div>
      <div class="modalActions">
        <button class="btn ghost" onclick="shareWhatsApp()">Share on WhatsApp</button>
        <button class="btn primary" onclick="closeThanks()">Close</button>
      </div>
    </div>
  </div>

<script>
  // ====== CONFIG ======
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzKuajt6yz4L2DnNbDuTf5V9DgdfN4pbLN5OeOvXBpzum-TugnV0x11YpT1e7TiSV-N/exec";
  const TARGET = 500000;
  const TILL = "4341738";
  // ====================

  let selectedAmount = null;

  const selAmtEl = document.getElementById("selAmt");
  const refEl = document.getElementById("ref");
  const customAmt = document.getElementById("customAmt");
  const buttons = document.querySelectorAll(".amt");

  const totalRaisedEl = document.getElementById("totalRaised");
  const participantsEl = document.getElementById("participants");
  const remainingEl = document.getElementById("remaining");
  const fillEl = document.getElementById("fill");
  const barNoteEl = document.getElementById("barNote");
  const toastEl = document.getElementById("toast");

  const thanksModal = document.getElementById("thanksModal");
  const thanksText = document.getElementById("thanksText");

  function openThanks(msg){
    thanksText.textContent = msg;
    thanksModal.style.display = "block";
  }
  function closeThanks(){
    thanksModal.style.display = "none";
  }

  function showToast(msg){
    toastEl.style.display = "block";
    toastEl.textContent = msg;
    setTimeout(()=>{ toastEl.style.display = "none"; }, 2600);
  }

  function genRef(){
    const d = new Date();
    const y = String(d.getFullYear()).slice(2);
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    const rnd = Math.random().toString(36).slice(2,6).toUpperCase();
    return `ELW-${y}${m}${day}-${rnd}`;
  }

  function setAmount(val){
    selectedAmount = val;
    selAmtEl.textContent = `KSh ${val.toLocaleString()}`;
    refEl.textContent = genRef();
    localStorage.setItem("elw_amt", String(val));
    localStorage.setItem("elw_ref", refEl.textContent);
  }

  buttons.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      buttons.forEach(b=>b.classList.remove("sel"));
      btn.classList.add("sel");
      const v = btn.dataset.amt;

      if(v === "custom"){
        selectedAmount = null;
        selAmtEl.textContent = "Custom amount";
        refEl.textContent = genRef();
        localStorage.setItem("elw_ref", refEl.textContent);
        customAmt.focus();
      } else {
        customAmt.value = "";
        setAmount(Number(v));
      }
    });
  });

  customAmt.addEventListener("input", ()=>{
    const v = Number(customAmt.value);
    if(v > 0){
      buttons.forEach(b=>b.classList.remove("sel"));
      selAmtEl.textContent = `KSh ${v.toLocaleString()}`;
      selectedAmount = v;
      if(refEl.textContent === "—") refEl.textContent = genRef();
      localStorage.setItem("elw_amt", String(v));
      localStorage.setItem("elw_ref", refEl.textContent);
    }
  });

  function copyTill(){
    navigator.clipboard.writeText(TILL).then(()=> showToast("Till copied: " + TILL));
  }

  function copyAmount(){
    const amt = selectedAmount || Number(localStorage.getItem("elw_amt"));
    if(!amt) return showToast("Select an amount first.");
    navigator.clipboard.writeText(String(amt)).then(()=> showToast("Amount copied: KSh " + amt));
  }

  function shareWhatsApp(){
    const msg =
`RAMADAN IFTAR DRIVE | ELWAK
Feed a fasting family for the sake of Allah.
Choose a challenge amount and participate here:
${location.href}

Buy Goods Till: ${TILL}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, "_blank");
  }

  function openMpesa(){
    const amt = selectedAmount || Number(localStorage.getItem("elw_amt"));
    const ref = refEl.textContent;

    if(!amt) { showToast("Select an amount first."); return; }

    // Optional: try opening SIM Toolkit (may work on some Android phones)
    const intents = [
      "intent://#Intent;action=android.intent.action.MAIN;category=android.intent.category.LAUNCHER;package=com.android.stk;end",
      "intent://#Intent;action=android.intent.action.MAIN;category=android.intent.category.LAUNCHER;package=com.android.stk2;end"
    ];
    try { window.location.href = intents[0]; } catch(e){}

    setTimeout(() => {
      alert(
`PAY WITH M-PESA (NORMAL STEPS)

1) Open M-Pesa
2) Lipa na M-Pesa
3) Buy Goods
4) Till: ${TILL}
5) Amount: KSh ${amt.toLocaleString()}
6) Pay, then return and tap ✅ I’ve Participated

Reference: ${ref && ref !== "—" ? ref : "(select amount)"}`
      );
    }, 350);
  }

  async function refreshTotals(){
    try{
      const res = await fetch(SCRIPT_URL, { method:"GET" });
      const data = await res.json();
      if(!data.ok) return;

      const total = Number(data.total || 0);
      const count = Number(data.count || 0);

      totalRaisedEl.textContent = "KSh " + total.toLocaleString();
      participantsEl.textContent = count.toLocaleString();

      const remaining = Math.max(0, TARGET - total);
      remainingEl.textContent = "KSh " + remaining.toLocaleString();

      const pct = Math.min(100, (total / TARGET) * 100);
      fillEl.style.width = pct.toFixed(1) + "%";
      barNoteEl.textContent = `${pct.toFixed(1)}% of target reached`;
    }catch(e){
      // ignore
    }
  }

  async function iParticipated(){
    const amt = selectedAmount || Number(localStorage.getItem("elw_amt"));
    const ref = refEl.textContent;

    if(!amt){ showToast("Select an amount first."); return; }

    try{
      const res = await fetch(SCRIPT_URL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ amount: amt, ref })
      });
      const data = await res.json();
      if(data.ok){
        showToast("Recorded ✅ Thank you!");
        openThanks(`Your participation of KSh ${amt.toLocaleString()} has been recorded. May Allah accept it and multiply your reward.`);
        await refreshTotals();
      }else{
        showToast("Could not record. Try again.");
      }
    }catch(e){
      showToast("Network error. Try again.");
    }
  }

  function resetAll(){
    selectedAmount = null;
    customAmt.value = "";
    selAmtEl.textContent = "None";
    refEl.textContent = "—";
    buttons.forEach(b=>b.classList.remove("sel"));
    localStorage.removeItem("elw_amt");
    localStorage.removeItem("elw_ref");
  }

  // Restore after refresh
  const savedAmt = Number(localStorage.getItem("elw_amt"));
  const savedRef = document.getElementById("ref");
  const savedRefVal = localStorage.getItem("elw_ref");
  if(savedRefVal) savedRef.textContent = savedRefVal;

  if(savedAmt){
    selectedAmount = savedAmt;
    selAmtEl.textContent = `KSh ${savedAmt.toLocaleString()}`;
  }

  refreshTotals();
  setInterval(refreshTotals, 30000);
</script>
</body>
</html>
