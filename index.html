<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ramadan Iftar Drive | Elwak</title>

  <style>
    /* Professional Color Palette - Warm & Inviting with Perfect Harmony */
    :root{
      /* Primary Colors - Deep Teal & Warm Terracotta */
      --primary-dark:#134e4a;        /* Deep teal - trust & stability */
      --primary-main:#0f766e;         /* Rich teal - main brand color */
      --primary-light:#5eead4;        /* Light teal - accents */
      --primary-subtle:#ccfbf1;       /* Very light teal - backgrounds */
      
      /* Secondary Colors - Warm Terracotta/Coral */
      --secondary-dark:#9a3412;       /* Deep terracotta */
      --secondary-main:#ea580c;       /* Vibrant coral - CTAs */
      --secondary-light:#fdba74;      /* Light coral - highlights */
      --secondary-subtle:#fed7aa;     /* Very light coral - backgrounds */
      
      /* Accent - Warm Gold */
      --accent-dark:#92400e;          /* Deep amber */
      --accent-main:#d97706;          /* Rich amber/gold */
      --accent-light:#fbbf24;         /* Bright gold */
      --accent-subtle:#fef3c7;        /* Light cream */
      
      /* Neutrals - Warm Grays */
      --text-primary:#1e293b;         /* Almost black */
      --text-secondary:#475569;       /* Medium gray */
      --text-tertiary:#64748b;        /* Light gray */
      --border-main:#e2e8f0;          /* Subtle border */
      --border-light:#f1f5f9;         /* Very light border */
      --bg-primary:#ffffff;           /* Pure white */
      --bg-secondary:#f8fafc;         /* Off white */
      --bg-tertiary:#f1f5f9;          /* Light gray bg */
      
      /* Shadows */
      --shadow-sm:0 1px 2px 0 rgba(0,0,0,0.05);
      --shadow-md:0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
      --shadow-xl:0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
    }

    body{
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      color:var(--text-primary);
      min-height:100vh;
      background: linear-gradient(135deg, var(--primary-subtle) 0%, var(--bg-secondary) 50%, var(--secondary-subtle) 100%);
      padding:24px 16px;
      line-height:1.6;
      -webkit-font-smoothing: antialiased;
    }

    .container{
      max-width:1100px;
      margin:0 auto;
      background:var(--bg-primary);
      border-radius:24px;
      box-shadow:var(--shadow-xl);
      overflow:hidden;
    }

    /* Elegant Top Accent */
    .top-accent{
      height:5px;
      background: linear-gradient(90deg, var(--primary-main) 0%, var(--accent-main) 50%, var(--secondary-main) 100%);
    }

    /* Header */
    .header{
      padding:48px 32px 36px;
      text-align:center;
      background:var(--bg-primary);
    }

    .badges{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      margin-bottom:24px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 18px;
      border-radius:100px;
      background:var(--primary-subtle);
      color:var(--primary-dark);
      font-weight:600;
      font-size:0.9375rem;
      border:1.5px solid var(--primary-light);
      letter-spacing:-0.01em;
    }

    .live-badge{
      background:var(--accent-subtle);
      color:var(--accent-dark);
      border-color:var(--accent-light);
      font-weight:700;
    }

    .live-count{
      font-weight:800;
      font-size:1.0625rem;
      color:var(--accent-dark);
    }

    h1{
      font-size:clamp(1.875rem, 4.5vw, 2.75rem);
      font-weight:700;
      line-height:1.15;
      margin:0 0 20px;
      color:var(--text-primary);
      letter-spacing:-0.02em;
    }

    .subtitle{
      max-width:680px;
      margin:0 auto 24px;
      color:var(--text-secondary);
      font-size:1.0625rem;
      line-height:1.7;
      font-weight:500;
    }

    .subtitle b{
      color:var(--primary-dark);
      font-weight:700;
    }

    .quote{
      max-width:720px;
      margin:0 auto;
      padding:20px 28px;
      border-radius:16px;
      background:var(--accent-subtle);
      border-left:5px solid var(--accent-main);
      color:var(--accent-dark);
      font-weight:600;
      line-height:1.65;
      font-size:1rem;
      font-style:italic;
    }

    /* Stats */
    .stats-wrapper{
      padding:32px;
      background:var(--bg-secondary);
    }

    .stats{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
      gap:20px;
      margin-bottom:24px;
    }

    .stat{
      padding:28px 24px;
      background:var(--bg-primary);
      border:1.5px solid var(--border-main);
      border-radius:16px;
      text-align:center;
      transition:all 0.3s ease;
      box-shadow:var(--shadow-sm);
    }

    .stat:hover{
      transform:translateY(-3px);
      box-shadow:var(--shadow-lg);
      border-color:var(--primary-light);
    }

    .stat-label{
      display:block;
      color:var(--text-tertiary);
      font-weight:600;
      font-size:0.875rem;
      margin-bottom:10px;
      text-transform:uppercase;
      letter-spacing:0.05em;
    }

    .stat-value{
      font-size:1.625rem;
      font-weight:800;
      color:var(--primary-dark);
      letter-spacing:-0.02em;
    }

    /* Progress */
    .progress-wrapper{
      background:var(--bg-primary);
      border:1.5px solid var(--border-main);
      border-radius:16px;
      padding:24px;
      box-shadow:var(--shadow-sm);
    }

    .progress-bar{
      height:18px;
      border-radius:100px;
      background:var(--bg-tertiary);
      overflow:hidden;
      position:relative;
    }

    .progress-fill{
      height:100%;
      border-radius:100px;
      background: linear-gradient(90deg, var(--primary-main), var(--accent-main));
      transition:width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow:0 2px 8px rgba(15,118,110,0.4);
    }

    .progress-label{
      margin-top:14px;
      text-align:center;
      color:var(--text-secondary);
      font-weight:700;
      font-size:0.9375rem;
    }

    /* Main Grid */
    .main-grid{
      display:grid;
      grid-template-columns:1.4fr 1fr;
      gap:24px;
      padding:32px;
      background:var(--bg-secondary);
    }

    .panel{
      background:var(--bg-primary);
      border:1.5px solid var(--border-main);
      border-radius:18px;
      padding:32px;
      box-shadow:var(--shadow-md);
    }

    .panel-title{
      color:var(--primary-dark);
      font-weight:700;
      font-size:0.9375rem;
      line-height:1.7;
      margin-bottom:24px;
      padding-bottom:20px;
      border-bottom:2px solid var(--border-light);
    }

    .panel-title b{
      color:var(--secondary-main);
      font-weight:800;
    }

    /* Amount Grid */
    .amounts{
      display:grid;
      grid-template-columns:repeat(4, 1fr);
      gap:12px;
      margin-bottom:24px;
    }

    .amount-option{
      padding:18px 14px;
      border:2px solid var(--border-main);
      border-radius:12px;
      background:var(--bg-primary);
      color:var(--text-primary);
      font-weight:700;
      font-size:0.9375rem;
      cursor:pointer;
      transition:all 0.25s ease;
      text-align:center;
      user-select:none;
    }

    .amount-option:hover{
      border-color:var(--primary-main);
      background:var(--primary-subtle);
      transform:translateY(-2px);
      box-shadow:var(--shadow-md);
    }

    .amount-option.active{
      background: linear-gradient(135deg, var(--primary-subtle), var(--accent-subtle));
      border-color:var(--primary-main);
      color:var(--primary-dark);
      font-weight:800;
      box-shadow:var(--shadow-lg);
    }

    /* Inputs */
    .inputs{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-bottom:24px;
    }

    input{
      padding:16px 18px;
      border:2px solid var(--border-main);
      border-radius:12px;
      font-size:1rem;
      font-weight:500;
      background:var(--bg-primary);
      color:var(--text-primary);
      transition:all 0.25s ease;
      outline:none;
    }

    input:focus{
      border-color:var(--primary-main);
      box-shadow:0 0 0 4px var(--primary-subtle);
    }

    input::placeholder{
      color:var(--text-tertiary);
      font-weight:500;
    }

    /* Instructions */
    .instructions{
      background: linear-gradient(135deg, var(--primary-subtle), var(--bg-tertiary));
      border:1.5px solid var(--primary-light);
      border-radius:14px;
      padding:24px;
      margin-top:24px;
    }

    .instructions-title{
      font-weight:800;
      color:var(--primary-dark);
      margin-bottom:16px;
      font-size:0.9375rem;
    }

    .steps{
      display:grid;
      gap:12px;
    }

    .step{
      display:flex;
      gap:14px;
      align-items:flex-start;
      padding:14px 16px;
      background:var(--bg-primary);
      border-radius:10px;
      border:1px solid var(--border-main);
    }

    .step-num{
      width:32px;
      height:32px;
      border-radius:50%;
      background:var(--primary-main);
      color:var(--bg-primary);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:800;
      font-size:0.875rem;
      flex-shrink:0;
    }

    .step-text{
      flex:1;
      color:var(--text-primary);
      font-weight:600;
      font-size:0.9375rem;
      line-height:1.6;
    }

    .step-text b{
      color:var(--primary-dark);
    }

    /* Summary */
    .summary{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-bottom:24px;
    }

    .summary-card{
      padding:18px;
      background:var(--bg-secondary);
      border:1.5px solid var(--border-main);
      border-radius:12px;
      text-align:center;
    }

    .summary-label{
      display:block;
      font-size:0.8125rem;
      color:var(--text-tertiary);
      font-weight:600;
      margin-bottom:8px;
      text-transform:uppercase;
      letter-spacing:0.05em;
    }

    .summary-value{
      font-weight:800;
      color:var(--text-primary);
      font-size:1.0625rem;
      word-break:break-word;
      letter-spacing:-0.01em;
    }

    /* Till Box */
    .till{
      background: linear-gradient(135deg, var(--primary-subtle), var(--accent-subtle));
      border:2.5px solid var(--primary-main);
      border-radius:16px;
      padding:28px;
      text-align:center;
      margin-bottom:24px;
    }

    .till-label{
      font-weight:700;
      text-transform:uppercase;
      font-size:0.8125rem;
      color:var(--primary-dark);
      margin-bottom:10px;
      letter-spacing:0.1em;
    }

    .till-number{
      font-size:2.75rem;
      font-weight:900;
      letter-spacing:0.15em;
      color:var(--primary-dark);
    }

    /* Buttons */
    .buttons{
      display:grid;
      gap:12px;
    }

    .btn{
      padding:16px 24px;
      border:none;
      border-radius:12px;
      font-weight:700;
      font-size:0.9375rem;
      cursor:pointer;
      transition:all 0.25s ease;
      text-align:center;
    }

    .btn:active{
      transform:scale(0.97);
    }

    .btn-primary{
      background:var(--secondary-main);
      color:#ffffff;
      box-shadow:var(--shadow-md);
    }

    .btn-primary:hover{
      background:var(--secondary-dark);
      box-shadow:var(--shadow-lg);
    }

    .btn-secondary{
      background:var(--bg-tertiary);
      color:var(--text-primary);
      border:1.5px solid var(--border-main);
    }

    .btn-secondary:hover{
      background:var(--border-light);
      border-color:var(--primary-light);
    }

    .btn-accent{
      background: linear-gradient(135deg, var(--accent-main), var(--accent-light));
      color:#ffffff;
      box-shadow:var(--shadow-md);
    }

    .btn-accent:hover{
      background: linear-gradient(135deg, var(--accent-dark), var(--accent-main));
      box-shadow:var(--shadow-lg);
    }

    .btn-danger{
      background:var(--bg-primary);
      color:#dc2626;
      border:1.5px solid #fecaca;
    }

    .btn-danger:hover{
      background:#fef2f2;
    }

    /* Footer */
    .footer{
      padding:24px 32px;
      text-align:center;
      background:var(--bg-tertiary);
      border-top:1.5px solid var(--border-main);
      color:var(--text-secondary);
      font-weight:600;
      font-size:0.9375rem;
    }

    /* Toast */
    .toast{
      position:fixed;
      bottom:32px;
      left:50%;
      transform:translateX(-50%) translateY(100px);
      padding:18px 28px;
      border-radius:14px;
      background:var(--primary-dark);
      color:#ffffff;
      font-weight:700;
      box-shadow:var(--shadow-xl);
      opacity:0;
      transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      max-width:min(520px, 90vw);
      text-align:center;
      z-index:9999;
    }

    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(0);
    }

    /* Modal */
    .modal-overlay{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.5);
      padding:24px;
      z-index:9998;
      backdrop-filter:blur(4px);
      align-items:center;
      justify-content:center;
    }

    .modal-overlay.show{
      display:flex;
    }

    .modal{
      max-width:520px;
      width:100%;
      background:var(--bg-primary);
      border-radius:20px;
      padding:36px;
      box-shadow:var(--shadow-xl);
    }

    .modal-title{
      font-weight:800;
      color:var(--primary-dark);
      font-size:1.375rem;
      margin-bottom:20px;
      letter-spacing:-0.01em;
    }

    .modal-text{
      color:var(--text-primary);
      font-weight:500;
      line-height:1.7;
      white-space:pre-line;
      margin-bottom:28px;
    }

    .modal-buttons{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }

    /* Responsive */
    @media (max-width:900px){
      .main-grid{
        grid-template-columns:1fr;
      }
      
      .amounts{
        grid-template-columns:repeat(2, 1fr);
      }

      .inputs{
        grid-template-columns:1fr;
      }

      .modal-buttons{
        grid-template-columns:1fr;
      }
    }

    @media (max-width:600px){
      body{
        padding:12px;
      }

      .header{
        padding:32px 24px 24px;
      }

      .stats-wrapper,
      .main-grid{
        padding:24px;
      }

      .panel{
        padding:24px;
      }

      .till-number{
        font-size:2.25rem;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="top-accent"></div>

    <div class="header">
      <div class="badges">
        <div class="badge">ðŸŒ™ Ramadan Iftar Drive â€¢ Elwak</div>
        <div class="live-badge">ðŸ‘¥ <span class="live-count" id="donorCount">0</span> people joined</div>
      </div>

      <h1>Feed a Fasting Family This Ramadan</h1>

      <p class="subtitle">
        Ramadan begins on <b>19th</b>. We are raising funds to prepare food packages for vulnerable families in Elwak before the month starts. Every contribution helps relieve hardship and earns reward.
      </p>

      <div class="quote">
        "Whoever feeds a fasting person will have a reward equal to theirs, without reducing their reward in any way."
      </div>
    </div>

    <div class="stats-wrapper">
      <div class="stats">
        <div class="stat">
          <span class="stat-label">Total Raised</span>
          <div class="stat-value" id="totalRaised">KSh 0</div>
        </div>
        <div class="stat">
          <span class="stat-label">Participants</span>
          <div class="stat-value" id="participants">0</div>
        </div>
        <div class="stat">
          <span class="stat-label">Remaining</span>
          <div class="stat-value" id="remaining">KSh 500,000</div>
        </div>
      </div>

      <div class="progress-wrapper">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-label" id="progressText">0% of target reached</div>
      </div>
    </div>

    <div class="main-grid">
      <div class="panel">
        <div class="panel-title">
          Target: <b>KSh 500,000</b> â€¢ Cost per family pack: <b>KSh 5,000</b> â€¢ Goal: complete support before Ramadan begins.
        </div>

        <div class="amounts" id="amountGrid">
          <div class="amount-option" data-amount="100">KSh 100</div>
          <div class="amount-option" data-amount="200">KSh 200</div>
          <div class="amount-option" data-amount="300">KSh 300</div>
          <div class="amount-option" data-amount="500">KSh 500</div>
          <div class="amount-option" data-amount="1000">KSh 1,000</div>
          <div class="amount-option" data-amount="1500">KSh 1,500</div>
          <div class="amount-option" data-amount="2000">KSh 2,000</div>
          <div class="amount-option" data-amount="custom">Custom</div>
        </div>

        <div class="inputs">
          <input id="customAmount" type="number" min="1" inputmode="numeric" placeholder="Custom amount (e.g., 750)" />
          <input id="nameInput" type="text" maxlength="40" placeholder="Your name (optional)" />
        </div>

        <div class="instructions">
          <div class="instructions-title">Simple steps:</div>
          <div class="steps">
            <div class="step">
              <div class="step-num">1</div>
              <div class="step-text">Select an amount (or enter any amount).</div>
            </div>
            <div class="step">
              <div class="step-num">2</div>
              <div class="step-text">Pay via M-Pesa: <b>Lipa na M-Pesa â†’ Buy Goods</b> â†’ Till <b>4341738</b> â†’ Amount â†’ PIN.</div>
            </div>
            <div class="step">
              <div class="step-num">3</div>
              <div class="step-text">Return here and tap <b>I Have Contributed</b> to record your participation.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="summary">
          <div class="summary-card">
            <span class="summary-label">Selected Amount</span>
            <div class="summary-value" id="selectedAmount">None</div>
          </div>
          <div class="summary-card">
            <span class="summary-label">Reference</span>
            <div class="summary-value" id="reference">â€”</div>
          </div>
        </div>

        <div class="till">
          <div class="till-label">Buy Goods Till Number</div>
          <div class="till-number" id="tillText">4341738</div>
        </div>

        <div class="buttons">
          <button class="btn btn-accent" onclick="payNow()">ðŸ’³ Pay Now</button>
          <button class="btn btn-secondary" onclick="copyTillNumber()">ðŸ“‹ Copy Till</button>
          <button class="btn btn-secondary" onclick="copySelectedAmount()">ðŸ’° Copy Amount</button>
          <button class="btn btn-primary" onclick="recordContribution()">âœ… I Have Contributed</button>
          <button class="btn btn-danger" onclick="resetSelection()">ðŸ”„ Reset</button>
        </div>
      </div>
    </div>

    <div class="footer">Ramadan â€¢ Mercy â€¢ Shared Responsibility</div>
  </div>

  <div id="toast" class="toast"></div>

  <div id="thanksModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-title">Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±Ù‹Ø§ â€” May Allah Reward You</div>
      <div id="thanksText" class="modal-text"></div>
      <div class="modal-buttons">
        <button class="btn btn-secondary" onclick="shareOnWhatsApp()">ðŸ“± Share</button>
        <button class="btn btn-accent" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>

  <script>
    const CONFIG = {
      GOOGLE_SCRIPT_URL: "https://script.google.com/macros/s/AKfycbxgmGgwEFODJr3Q6K9vwz8D706EBUqhZDJqMAyoDVNdl5sspJERk40V-lDgznI8R1rJ/exec",
      TARGET_AMOUNT: 500000,
      TILL_NUMBER: "4341738",
      REF_PREFIX: "ELW"
    };

    let state = {
      selectedAmount: null,
      reference: null,
      recorded: false
    };

    const el = {
      totalRaised: document.getElementById('totalRaised'),
      participants: document.getElementById('participants'),
      remaining: document.getElementById('remaining'),
      progressFill: document.getElementById('progressFill'),
      progressText: document.getElementById('progressText'),
      donorCount: document.getElementById('donorCount'),
      selectedAmount: document.getElementById('selectedAmount'),
      reference: document.getElementById('reference'),
      customAmount: document.getElementById('customAmount'),
      nameInput: document.getElementById('nameInput'),
      toast: document.getElementById('toast'),
      thanksModal: document.getElementById('thanksModal'),
      thanksText: document.getElementById('thanksText'),
      amtBtns: document.querySelectorAll('.amount-option')
    };

    function generateReference(){
      const d = new Date();
      const yy = String(d.getFullYear()).slice(2);
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      const rnd = Math.random().toString(36).slice(2,6).toUpperCase();
      return `${CONFIG.REF_PREFIX}-${yy}${mm}${dd}-${rnd}`;
    }

    function formatCurrency(x){ return `KSh ${Number(x).toLocaleString()}`; }

    function showToast(msg, t=2600){
      el.toast.textContent = msg;
      el.toast.classList.add('show');
      setTimeout(()=>el.toast.classList.remove('show'), t);
    }

    function saveLocal(){
      localStorage.setItem('el_amt', state.selectedAmount ? String(state.selectedAmount) : '');
      localStorage.setItem('el_ref', state.reference || '');
      localStorage.setItem('el_name', el.nameInput.value || '');
      localStorage.setItem('el_recorded', String(state.recorded));
    }

    function loadLocal(){
      const a = localStorage.getItem('el_amt');
      const r = localStorage.getItem('el_ref');
      const n = localStorage.getItem('el_name');
      const rec = localStorage.getItem('el_recorded') === 'true';

      if(a){
        state.selectedAmount = Number(a);
        el.selectedAmount.textContent = formatCurrency(state.selectedAmount);
      }
      if(r){
        state.reference = r;
        el.reference.textContent = r;
      }
      if(n) el.nameInput.value = n;
      state.recorded = rec;
    }

    function setAmount(amount){
      state.selectedAmount = amount;
      state.reference = generateReference();
      state.recorded = false;
      el.selectedAmount.textContent = formatCurrency(amount);
      el.reference.textContent = state.reference;
      saveLocal();
    }

    el.amtBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        el.amtBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');

        const v = btn.dataset.amount;
        if(v === 'custom'){
          state.selectedAmount = null;
          state.reference = generateReference();
          state.recorded = false;
          el.selectedAmount.textContent = 'Custom';
          el.reference.textContent = state.reference;
          saveLocal();
          el.customAmount.focus();
          return;
        }

        el.customAmount.value = '';
        setAmount(Number(v));
      });
    });

    el.customAmount.addEventListener('input', (e)=>{
      const v = Number(e.target.value);
      if(v > 0){
        el.amtBtns.forEach(b=>b.classList.remove('active'));
        setAmount(v);
      }
    });

    el.nameInput.addEventListener('input', saveLocal);

    function payNow(){
      const amount = state.selectedAmount || Number(localStorage.getItem('el_amt'));
      if(!amount){
        showToast('Please select an amount first.');
        return;
      }

      navigator.clipboard.writeText(CONFIG.TILL_NUMBER)
        .then(()=>showToast(`Till ${CONFIG.TILL_NUMBER} copied. Open M-Pesa â†’ Buy Goods and pay.`))
        .catch(()=>showToast(`Open M-Pesa â†’ Buy Goods â†’ Till ${CONFIG.TILL_NUMBER} â†’ Amount ${amount}.`));

      const ussd = encodeURIComponent("*334#");
      setTimeout(()=>{ window.location.href = `tel:${ussd}`; }, 350);
    }

    function copyTillNumber(){
      navigator.clipboard.writeText(CONFIG.TILL_NUMBER)
        .then(()=>showToast(`Till ${CONFIG.TILL_NUMBER} copied.`))
        .catch(()=>showToast(`Copy failed. Till: ${CONFIG.TILL_NUMBER}`));
    }

    function copySelectedAmount(){
      const amount = state.selectedAmount || Number(localStorage.getItem('el_amt'));
      if(!amount){ showToast('Select an amount first.'); return; }
      navigator.clipboard.writeText(String(amount))
        .then(()=>showToast(`Amount ${amount} copied.`))
        .catch(()=>showToast(`Copy failed. Amount: ${amount}`));
    }

    async function recordContribution(){
      const amount = state.selectedAmount || Number(localStorage.getItem('el_amt'));
      const reference = state.reference || localStorage.getItem('el_ref') || generateReference();
      const name = (el.nameInput.value || localStorage.getItem('el_name') || '').trim();

      if(!amount){ showToast('Please select an amount first.'); return; }
      if(state.recorded){ showToast('Already recorded. Thank you!'); return; }

      showToast('Recording your participation...');

      try{
        const controller = new AbortController();
        const timeoutId = setTimeout(()=>controller.abort(), 15000);

        const payload = {
          amount,
          ref: reference,
          name: name || "Anonymous",
          timestamp: new Date().toISOString()
        };

        const res = await fetch(CONFIG.GOOGLE_SCRIPT_URL, {
          method:'POST',
          headers:{'Content-Type':'text/plain'},
          body: JSON.stringify(payload),
          signal: controller.signal
        });

        clearTimeout(timeoutId);
        if(!res.ok) throw new Error(`Server error (${res.status})`);

        const data = await res.json();
        if(!data || !data.ok) throw new Error('Could not record');

        state.recorded = true;
        state.reference = reference;
        el.reference.textContent = reference;
        saveLocal();

        el.thanksText.textContent =
          `Your participation has been recorded.\n\n` +
          `May Allah accept your generosity, multiply your reward, and place barakah in your wealth.\n\n` +
          `Recorded amount: ${formatCurrency(amount)}\nReference: ${reference}`;

        el.thanksModal.classList.add('show');
        showToast('Recorded. JazakAllahu khairan.');

        setTimeout(refreshStatistics, 600);

      }catch(err){
        if(err.name === 'AbortError') showToast('Timed out. Please check your internet and try again.');
        else showToast('Could not record now. Please try again.');
        console.error(err);
      }
    }

    function closeModal(){ 
      el.thanksModal.classList.remove('show');
    }

    function shareOnWhatsApp(){
      const msg =
`ðŸŒ™ RAMADAN IFTAR DRIVE â€¢ ELWAK

Ramadan begins on 19th. Help us prepare food packages for vulnerable families.

Till: ${CONFIG.TILL_NUMBER}
Target: KSh 500,000

Join here:
${window.location.href}

"Whoever feeds a fasting person will have a reward equal to theirs..."`;
      window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function resetSelection(){
      if(!confirm('Reset your selection?')) return;

      state.selectedAmount = null;
      state.reference = null;
      state.recorded = false;

      el.customAmount.value = '';
      el.selectedAmount.textContent = 'None';
      el.reference.textContent = 'â€”';
      el.amtBtns.forEach(b=>b.classList.remove('active'));

      localStorage.removeItem('el_amt');
      localStorage.removeItem('el_ref');
      localStorage.removeItem('el_recorded');

      showToast('Reset done.');
    }

    async function refreshStatistics(){
      try{
        const controller = new AbortController();
        const timeoutId = setTimeout(()=>controller.abort(), 10000);

        const res = await fetch(CONFIG.GOOGLE_SCRIPT_URL, { method:'GET', signal: controller.signal });
        clearTimeout(timeoutId);

        if(!res.ok) return;
        const data = await res.json();
        if(!data || !data.ok) return;

        const total = Number(data.total || 0);
        const count = Number(data.count || 0);
        const remaining = Math.max(0, CONFIG.TARGET_AMOUNT - total);
        const pct = Math.min(100, (total / CONFIG.TARGET_AMOUNT) * 100);

        el.totalRaised.textContent = formatCurrency(total);
        el.participants.textContent = count.toLocaleString();
        el.donorCount.textContent = count.toLocaleString();
        el.remaining.textContent = formatCurrency(remaining);
        el.progressFill.style.width = `${pct.toFixed(1)}%`;
        el.progressText.textContent = `${pct.toFixed(1)}% of target reached`;
      }catch(e){
        // silent
      }
    }

    function init(){
      loadLocal();

      if((state.selectedAmount || Number(localStorage.getItem('el_amt'))) && (!state.reference || state.reference === 'â€”')){
        state.reference = generateReference();
        el.reference.textContent = state.reference;
        saveLocal();
      }

      refreshStatistics();
      setInterval(refreshStatistics, 30000);
    }

    init();
  </script>
</body>
</html>
