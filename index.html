<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ramadan Iftar Drive | Elwak</title>

  <style>
    :root{
      --ink:#0b1220;
      --muted:#5b6b82;
      --card:#ffffff;
      --line:rgba(16,24,40,.10);
      --shadow:0 18px 50px rgba(2,8,23,.10);
      --blue:#165dff;
      --blue2:#0b3c5d;
      --gold:#d9a200;
      --green:#1eb53a;
      --greenDark:#149a2c;
      --bg1:#f6f9ff;
      --bg2:#eef4ff;
      --bg3:#ffffff;
    }

    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", sans-serif;
      color:var(--ink);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      background:
        radial-gradient(900px 420px at 12% 8%, rgba(22,93,255,.10), transparent 60%),
        radial-gradient(900px 420px at 88% 18%, rgba(30,181,58,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2) 48%, var(--bg3));
    }

    .container{
      width:min(980px,100%);
      background:var(--card);
      border:1px solid var(--line);
      border-radius:22px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    /* Top accent strip */
    .accent{
      height:10px;
      background: linear-gradient(90deg, var(--blue), #2b8cff, var(--green), #ffd05a);
    }

    .header{
      padding:22px 20px 12px;
      text-align:center;
    }

    .chipRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      margin-bottom:12px;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 14px;
      border-radius:999px;
      background:rgba(22,93,255,.08);
      border:1px solid rgba(22,93,255,.16);
      color:var(--blue2);
      font-weight:900;
      letter-spacing:.6px;
      text-transform:uppercase;
      font-size:.78rem;
    }

    .liveCounter{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      border-radius:999px;
      background:rgba(30,181,58,.08);
      border:1px solid rgba(30,181,58,.18);
      color:var(--greenDark);
      font-weight:900;
      font-size:.9rem;
    }
    .liveCounter b{
      color:var(--greenDark);
      font-size:1.05rem;
      letter-spacing:.4px;
    }

    h1{
      font-size:clamp(1.55rem,3.6vw,2.6rem);
      font-weight:1000;
      line-height:1.15;
      margin:6px 0 8px;
      color:var(--ink);
    }

    .subtitle{
      max-width:780px;
      margin:0 auto 12px;
      color:var(--muted);
      line-height:1.7;
      font-size:1.02rem;
      font-weight:650;
    }

    .quote{
      max-width:860px;
      margin:0 auto 10px;
      padding:12px 14px;
      border-radius:14px;
      background:rgba(217,162,0,.08);
      border:1px solid rgba(217,162,0,.18);
      color:#5a4300;
      font-weight:800;
      line-height:1.55;
      font-size:.98rem;
    }

    .stats{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
      padding:12px 20px 18px;
    }

    .stat{
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      background:#fff;
      box-shadow:0 10px 28px rgba(2,8,23,.06);
      text-align:center;
    }

    .stat span{
      display:block;
      color:var(--muted);
      font-weight:800;
      font-size:.9rem;
      margin-bottom:6px;
    }

    .stat b{
      font-size:1.18rem;
      font-weight:1000;
      color:var(--blue2);
    }

    .progressWrap{
      margin:0 20px 18px;
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background:#fff;
      box-shadow:0 10px 28px rgba(2,8,23,.06);
    }

    .bar{
      height:14px;
      border-radius:999px;
      background:rgba(15,23,42,.08);
      overflow:hidden;
    }

    .fill{
      height:100%;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg, var(--green), #2b8cff, #ffd05a);
      transition:width .6s cubic-bezier(.4,0,.2,1);
    }

    .barText{
      margin-top:10px;
      color:var(--muted);
      font-weight:900;
      font-size:.92rem;
      text-align:center;
    }

    .grid{
      display:grid;
      grid-template-columns:1.2fr .8fr;
      gap:16px;
      padding:0 20px 20px;
    }

    .panel{
      border:1px solid var(--line);
      border-radius:18px;
      padding:16px;
      background:#fff;
      box-shadow:0 10px 28px rgba(2,8,23,.06);
    }

    .panelTitle{
      color:var(--blue2);
      font-weight:1000;
      font-size:.95rem;
      line-height:1.5;
      margin-bottom:10px;
    }

    .amountGrid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
      margin-top:12px;
    }

    .amtBtn{
      border:1px solid rgba(16,24,40,.12);
      border-radius:14px;
      padding:12px 10px;
      cursor:pointer;
      background:rgba(22,93,255,.06);
      color:var(--blue2);
      font-weight:1000;
      transition:all .15s ease;
      text-align:center;
      user-select:none;
    }
    .amtBtn:hover{ transform:translateY(-1px); background:rgba(22,93,255,.10); }
    .amtBtn.selected{
      background:linear-gradient(135deg, rgba(30,181,58,.18), rgba(22,93,255,.10));
      border-color:rgba(30,181,58,.35);
      box-shadow:0 12px 24px rgba(30,181,58,.12);
    }

    .inputs{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }

    input{
      flex:1 1 240px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(16,24,40,.12);
      outline:none;
      font-size:1rem;
      font-weight:650;
      background:#fff;
      color:var(--ink);
    }
    input:focus{
      border-color:rgba(22,93,255,.40);
      box-shadow:0 0 0 4px rgba(22,93,255,.12);
    }
    input::placeholder{ color:#8a98ad; font-weight:650; }

    .infoGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-bottom:12px;
    }

    .info{
      border:1px solid rgba(16,24,40,.10);
      border-radius:14px;
      padding:12px;
      background:rgba(2,8,23,.02);
      text-align:center;
    }

    .info small{
      display:block;
      color:var(--muted);
      font-weight:900;
      margin-bottom:4px;
    }

    .info strong{
      display:block;
      font-weight:1000;
      color:var(--ink);
      word-break:break-word;
    }

    .tillBox{
      margin-top:10px;
      border-radius:16px;
      padding:16px;
      background:linear-gradient(135deg, rgba(30,181,58,.18), rgba(30,181,58,.10));
      border:1px solid rgba(30,181,58,.30);
      text-align:center;
    }

    .tillLabel{
      font-weight:1000;
      letter-spacing:1.2px;
      text-transform:uppercase;
      font-size:.86rem;
      color:var(--greenDark);
      margin-bottom:6px;
    }

    .tillNum{
      font-size:2.2rem;
      font-weight:1100;
      letter-spacing:4px;
      color:var(--greenDark);
    }

    .how{
      margin-top:12px;
      border-radius:14px;
      padding:12px;
      background:rgba(22,93,255,.06);
      border:1px solid rgba(22,93,255,.14);
      color:var(--blue2);
      font-weight:800;
      line-height:1.6;
      font-size:.95rem;
    }

    .steps{
      margin-top:10px;
      display:grid;
      gap:8px;
    }
    .step{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:10px 12px;
      border-radius:12px;
      background:#fff;
      border:1px solid rgba(16,24,40,.08);
      font-weight:850;
      color:var(--ink);
    }
    .n{
      width:26px;height:26px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      background:rgba(22,93,255,.10);
      border:1px solid rgba(22,93,255,.18);
      color:var(--blue2);
      font-weight:1100;
      flex:0 0 auto;
      margin-top:1px;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
      justify-content:center;
    }

    button{
      border:none;
      border-radius:14px;
      padding:12px 16px;
      font-weight:1000;
      cursor:pointer;
      font-size:.92rem;
      transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
      white-space:nowrap;
    }
    button:active{ transform:scale(.98); }

    .primary{
      background:var(--green);
      color:#fff;
      box-shadow:0 10px 22px rgba(30,181,58,.18);
    }
    .primary:hover{ background:#22c943; }

    .secondary{
      background:rgba(2,8,23,.04);
      color:var(--ink);
      border:1px solid rgba(16,24,40,.10);
    }
    .secondary:hover{ background:rgba(2,8,23,.06); }

    .gold{
      background:linear-gradient(135deg, #ffd05a, #ffdf88);
      color:#3b2a00;
      box-shadow:0 10px 22px rgba(255,208,90,.20);
    }
    .gold:hover{ filter:brightness(.98); }

    .danger{
      background:#fff;
      color:#9b1c1c;
      border:1px solid rgba(155,28,28,.20);
    }
    .danger:hover{ background:rgba(155,28,28,.06); }

    .footer{
      text-align:center;
      padding:14px 20px;
      color:var(--muted);
      border-top:1px solid var(--line);
      font-weight:850;
      letter-spacing:.2px;
      background:rgba(2,8,23,.01);
    }

    /* Toast */
    .toast{
      position:fixed;
      bottom:26px;
      left:50%;
      transform:translateX(-50%) translateY(90px);
      padding:12px 16px;
      border-radius:12px;
      background:rgba(30,181,58,.95);
      color:#fff;
      font-weight:1000;
      box-shadow:0 18px 50px rgba(2,8,23,.18);
      opacity:0;
      transition:all .25s cubic-bezier(.4,0,.2,1);
      max-width:min(560px,92vw);
      text-align:center;
      z-index:9999;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(0);
    }

    /* Modal */
    .overlay{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(2,8,23,.55);
      padding:18px;
      z-index:9998;
      backdrop-filter: blur(4px);
    }
    .modal{
      max-width:560px;
      margin:12vh auto 0;
      background:#fff;
      border:1px solid rgba(16,24,40,.12);
      border-radius:18px;
      padding:18px;
      box-shadow:0 28px 70px rgba(2,8,23,.25);
    }
    .mTitle{
      font-weight:1100;
      color:var(--blue2);
      font-size:1.2rem;
      margin-bottom:10px;
    }
    .mText{
      color:var(--ink);
      font-weight:750;
      line-height:1.7;
      white-space:pre-line;
      margin-bottom:14px;
    }
    .mActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    @media (max-width:860px){
      .grid{ grid-template-columns:1fr; }
      .amountGrid{ grid-template-columns:repeat(2,1fr); }
      .stats{ grid-template-columns:1fr; }
      button{ width:100%; }
      .actions{ flex-direction:column; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="accent"></div>

    <div class="header">
      <div class="chipRow">
        <div class="chip">üåô Ramadan Iftar Drive ‚Ä¢ Elwak</div>
        <!-- LIVE DONOR COUNTER (A) -->
        <div class="liveCounter">üë• <b id="donorCount">0</b> people have joined</div>
      </div>

      <h1>Feed a Fasting Family This Ramadan</h1>

      <p class="subtitle">
        Ramadan begins on <b>19th</b>. We are raising funds to prepare food packages for vulnerable families in Elwak before the month starts.
        Every contribution helps relieve hardship and earns reward.
      </p>

      <div class="quote">
        ‚ÄúWhoever feeds a fasting person will have a reward equal to theirs, without reducing their reward in any way.‚Äù
      </div>
    </div>

    <div class="stats">
      <div class="stat">
        <span>Total Raised</span>
        <b id="totalRaised">KSh 0</b>
      </div>
      <div class="stat">
        <span>Participants</span>
        <b id="participants">0</b>
      </div>
      <div class="stat">
        <span>Remaining</span>
        <b id="remaining">KSh 500,000</b>
      </div>
    </div>

    <div class="progressWrap">
      <div class="bar"><div class="fill" id="progressFill"></div></div>
      <div class="barText" id="progressText">0% of target reached</div>
    </div>

    <div class="grid">
      <div class="panel">
        <div class="panelTitle">
          Target: <b>KSh 500,000</b> ‚Ä¢ Cost per family pack: <b>KSh 5,000</b> ‚Ä¢ Goal: complete support before Ramadan begins.
        </div>

        <div class="amountGrid" id="amountGrid">
          <div class="amtBtn" data-amount="100">KSh 100</div>
          <div class="amtBtn" data-amount="200">KSh 200</div>
          <div class="amtBtn" data-amount="300">KSh 300</div>
          <div class="amtBtn" data-amount="500">KSh 500</div>
          <div class="amtBtn" data-amount="1000">KSh 1,000</div>
          <div class="amtBtn" data-amount="1500">KSh 1,500</div>
          <div class="amtBtn" data-amount="2000">KSh 2,000</div>
          <div class="amtBtn" data-amount="custom">Custom</div>
        </div>

        <div class="inputs">
          <input id="customAmount" type="number" min="1" inputmode="numeric" placeholder="Enter custom amount (e.g., 750)" />
          <input id="nameInput" type="text" maxlength="40" placeholder="Your name (optional)" />
        </div>

        <div class="how">
          <b>Simple steps:</b>
          <div class="steps">
            <div class="step"><div class="n">1</div><div>Select an amount (or enter any amount).</div></div>
            <div class="step"><div class="n">2</div><div>Pay via M-Pesa: <b>Lipa na M-Pesa ‚Üí Buy Goods</b> ‚Üí Till <b>4341738</b> ‚Üí Amount ‚Üí PIN.</div></div>
            <div class="step"><div class="n">3</div><div>Return here and tap <b>I Have Contributed</b> to record your participation.</div></div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="infoGrid">
          <div class="info">
            <small>Selected Amount</small>
            <strong id="selectedAmount">None</strong>
          </div>
          <div class="info">
            <small>Reference</small>
            <strong id="reference">‚Äî</strong>
          </div>
        </div>

        <div class="tillBox">
          <div class="tillLabel">Buy Goods Till Number</div>
          <div class="tillNum" id="tillText">4341738</div>
        </div>

        <div class="actions">
          <button class="gold" onclick="payNow()">Pay Now</button>
          <button class="secondary" onclick="copyTillNumber()">Copy Till</button>
          <button class="secondary" onclick="copySelectedAmount()">Copy Amount</button>
          <button class="primary" onclick="recordContribution()">I Have Contributed</button>
          <button class="danger" onclick="resetSelection()">Reset</button>
        </div>
      </div>
    </div>

    <div class="footer">Ramadan ‚Ä¢ Mercy ‚Ä¢ Shared Responsibility</div>
  </div>

  <div id="toast" class="toast"></div>

  <div id="thanksModal" class="overlay">
    <div class="modal">
      <div class="mTitle">ÿ¨ÿ≤ÿßŸÉ ÿßŸÑŸÑŸá ÿÆŸäÿ±Ÿãÿß ‚Äî May Allah Reward You</div>
      <div id="thanksText" class="mText"></div>
      <div class="mActions">
        <button class="secondary" onclick="shareOnWhatsApp()">Share</button>
        <button class="gold" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>

  <script>
    // ========= CONFIG =========
    const CONFIG = {
      GOOGLE_SCRIPT_URL: "https://script.google.com/macros/s/AKfycbxgmGgwEFODJr3Q6K9vwz8D706EBUqhZDJqMAyoDVNdl5sspJERk40V-lDgznI8R1rJ/exec",
      TARGET_AMOUNT: 500000,
      TILL_NUMBER: "4341738",
      REF_PREFIX: "ELW"
    };

    // ========= STATE =========
    let state = {
      selectedAmount: null,
      reference: null,
      recorded: false
    };

    // ========= DOM =========
    const el = {
      totalRaised: document.getElementById('totalRaised'),
      participants: document.getElementById('participants'),
      remaining: document.getElementById('remaining'),
      progressFill: document.getElementById('progressFill'),
      progressText: document.getElementById('progressText'),
      donorCount: document.getElementById('donorCount'),
      selectedAmount: document.getElementById('selectedAmount'),
      reference: document.getElementById('reference'),
      customAmount: document.getElementById('customAmount'),
      nameInput: document.getElementById('nameInput'),
      toast: document.getElementById('toast'),
      thanksModal: document.getElementById('thanksModal'),
      thanksText: document.getElementById('thanksText'),
      amtBtns: document.querySelectorAll('.amtBtn')
    };

    // ========= HELPERS =========
    function generateReference(){
      const d = new Date();
      const yy = String(d.getFullYear()).slice(2);
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      const rnd = Math.random().toString(36).slice(2,6).toUpperCase();
      return `${CONFIG.REF_PREFIX}-${yy}${mm}${dd}-${rnd}`;
    }

    function formatCurrency(x){ return `KSh ${Number(x).toLocaleString()}`; }

    function showToast(msg, t=2600){
      el.toast.textContent = msg;
      el.toast.classList.add('show');
      setTimeout(()=>el.toast.classList.remove('show'), t);
    }

    function saveLocal(){
      localStorage.setItem('el_amt', state.selectedAmount ? String(state.selectedAmount) : '');
      localStorage.setItem('el_ref', state.reference || '');
      localStorage.setItem('el_name', el.nameInput.value || '');
      localStorage.setItem('el_recorded', String(state.recorded));
    }

    function loadLocal(){
      const a = localStorage.getItem('el_amt');
      const r = localStorage.getItem('el_ref');
      const n = localStorage.getItem('el_name');
      const rec = localStorage.getItem('el_recorded') === 'true';

      if(a){
        state.selectedAmount = Number(a);
        el.selectedAmount.textContent = formatCurrency(state.selectedAmount);
      }
      if(r){
        state.reference = r;
        el.reference.textContent = r;
      }
      if(n) el.nameInput.value = n;
      state.recorded = rec;
    }

    function setAmount(amount){
      state.selectedAmount = amount;
      state.reference = generateReference();
      state.recorded = false;
      el.selectedAmount.textContent = formatCurrency(amount);
      el.reference.textContent = state.reference;
      saveLocal();
    }

    // ========= AMOUNT UI =========
    el.amtBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        el.amtBtns.forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');

        const v = btn.dataset.amount;
        if(v === 'custom'){
          state.selectedAmount = null;
          state.reference = generateReference();
          state.recorded = false;
          el.selectedAmount.textContent = 'Custom';
          el.reference.textContent = state.reference;
          saveLocal();
          el.customAmount.focus();
          return;
        }

        el.customAmount.value = '';
        setAmount(Number(v));
      });
    });

    el.customAmount.addEventListener('input', (e)=>{
      const v = Number(e.target.value);
      if(v > 0){
        el.amtBtns.forEach(b=>b.classList.remove('selected'));
        setAmount(v);
      }
    });

    el.nameInput.addEventListener('input', saveLocal);

    // ========= PAY NOW (no Play Store redirects) =========
    function payNow(){
      const amount = state.selectedAmount || Number(localStorage.getItem('el_amt'));
      if(!amount){
        showToast('Please select an amount first.');
        return;
      }

      // Copy Till + Amount (works everywhere)
      navigator.clipboard.writeText(CONFIG.TILL_NUMBER)
        .then(()=>showToast(`Till ${CONFIG.TILL_NUMBER} copied. Open M-Pesa ‚Üí Buy Goods and pay.`))
        .catch(()=>showToast(`Open M-Pesa ‚Üí Buy Goods ‚Üí Till ${CONFIG.TILL_NUMBER} ‚Üí Amount ${amount}.`));

      // Optional: open dialer to USSD (some devices will show prompt)
      // This avoids Play Store redirects and does not break the page.
      const ussd = encodeURIComponent("*334#");
      setTimeout(()=>{ window.location.href = `tel:${ussd}`; }, 350);
    }

    function copyTillNumber(){
      navigator.clipboard.writeText(CONFIG.TILL_NUMBER)
        .then(()=>showToast(`Till ${CONFIG.TILL_NUMBER} copied.`))
        .catch(()=>showToast(`Copy failed. Till: ${CONFIG.TILL_NUMBER}`));
    }

    function copySelectedAmount(){
      const amount = state.selectedAmount || Number(localStorage.getItem('el_amt'));
      if(!amount){ showToast('Select an amount first.'); return; }
      navigator.clipboard.writeText(String(amount))
        .then(()=>showToast(`Amount ${amount} copied.`))
        .catch(()=>showToast(`Copy failed. Amount: ${amount}`));
    }

    // ========= RECORD CONTRIBUTION =========
    async function recordContribution(){
      const amount = state.selectedAmount || Number(localStorage.getItem('el_amt'));
      const reference = state.reference || localStorage.getItem('el_ref') || generateReference();
      const name = (el.nameInput.value || localStorage.getItem('el_name') || '').trim();

      if(!amount){ showToast('Please select an amount first.'); return; }
      if(state.recorded){ showToast('Already recorded. Thank you!'); return; }

      showToast('Recording your participation...');

      try{
        const controller = new AbortController();
        const timeoutId = setTimeout(()=>controller.abort(), 15000);

        const payload = {
          amount,
          ref: reference,
          name: name || "Anonymous",
          timestamp: new Date().toISOString()
        };

        const res = await fetch(CONFIG.GOOGLE_SCRIPT_URL, {
          method:'POST',
          headers:{'Content-Type':'text/plain'}, // avoids CORS preflight
          body: JSON.stringify(payload),
          signal: controller.signal
        });

        clearTimeout(timeoutId);
        if(!res.ok) throw new Error(`Server error (${res.status})`);

        const data = await res.json();
        if(!data || !data.ok) throw new Error('Could not record');

        state.recorded = true;
        state.reference = reference;
        el.reference.textContent = reference;
        saveLocal();

        el.thanksText.textContent =
          `Your participation has been recorded.\n\n` +
          `May Allah accept your generosity, multiply your reward, and place barakah in your wealth.\n\n` +
          `Recorded amount: ${formatCurrency(amount)}\nReference: ${reference}`;

        el.thanksModal.style.display = 'block';
        showToast('Recorded. JazakAllahu khairan.');

        setTimeout(refreshStatistics, 600);

      }catch(err){
        if(err.name === 'AbortError') showToast('Timed out. Please check your internet and try again.');
        else showToast('Could not record now. Please try again.');
        console.error(err);
      }
    }

    function closeModal(){ el.thanksModal.style.display = 'none'; }

    function shareOnWhatsApp(){
      const msg =
`üåô RAMADAN IFTAR DRIVE ‚Ä¢ ELWAK

Ramadan begins on 19th. Help us prepare food packages for vulnerable families.

Till: ${CONFIG.TILL_NUMBER}
Target: KSh 500,000

Join here:
${window.location.href}

‚ÄúWhoever feeds a fasting person will have a reward equal to theirs...‚Äù`;
      window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function resetSelection(){
      if(!confirm('Reset your selection?')) return;

      state.selectedAmount = null;
      state.reference = null;
      state.recorded = false;

      el.customAmount.value = '';
      el.selectedAmount.textContent = 'None';
      el.reference.textContent = '‚Äî';
      el.amtBtns.forEach(b=>b.classList.remove('selected'));

      localStorage.removeItem('el_amt');
      localStorage.removeItem('el_ref');
      localStorage.removeItem('el_recorded');

      showToast('Reset done.');
    }

    // ========= LIVE STATS (Donor counter A uses count) =========
    async function refreshStatistics(){
      try{
        const controller = new AbortController();
        const timeoutId = setTimeout(()=>controller.abort(), 10000);

        const res = await fetch(CONFIG.GOOGLE_SCRIPT_URL, { method:'GET', signal: controller.signal });
        clearTimeout(timeoutId);

        if(!res.ok) return;
        const data = await res.json();
        if(!data || !data.ok) return;

        const total = Number(data.total || 0);
        const count = Number(data.count || 0);
        const remaining = Math.max(0, CONFIG.TARGET_AMOUNT - total);
        const pct = Math.min(100, (total / CONFIG.TARGET_AMOUNT) * 100);

        el.totalRaised.textContent = formatCurrency(total);
        el.participants.textContent = count.toLocaleString();
        el.donorCount.textContent = count.toLocaleString(); // LIVE COUNTER (A)
        el.remaining.textContent = formatCurrency(remaining);
        el.progressFill.style.width = `${pct.toFixed(1)}%`;
        el.progressText.textContent = `${pct.toFixed(1)}% of target reached`;
      }catch(e){
        // silent
      }
    }

    function init(){
      loadLocal();

      if((state.selectedAmount || Number(localStorage.getItem('el_amt'))) && (!state.reference || state.reference === '‚Äî')){
        state.reference = generateReference();
        el.reference.textContent = state.reference;
        saveLocal();
      }

      refreshStatistics();
      setInterval(refreshStatistics, 30000);
    }

    init();
  </script>
</body>
</html>
